<!DOCTYPE html>
<html>
    <head>
        <title>Repl World</title>
    </head>
    <body>
        <div id="main">
            if (!user)
                <p>Please log in!</p>
                <script src="https://auth.turbio.repl.co/script.js" authed='location.reload()'></script>
            else 
                <p> Welcome, #{user.name}! </p>
        </div>
    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    
    script.
        let socket = io();
        let players = {};
        let ID = Math.round(Math.random() * 1000);
        let position = [0, 0];

        function set(dict, key, value) {
            dict[key] = value;
        }

        socket.emit("join", (ID, position));
        socket.on("joined", (id, p) => {
            set(players, id, {"position": p});
        });

        socket.on("move", (id, op, np) => {
            if (players[id] != null) {
                players[id]["position"] = np;
                console.log(`Player ${id} moved from ${op} to ${np}.`);
            } else if (players[id] == null) {
                players[id] = {"position": np};
                console.log(`Player ${id} moved to ${np}.`);
            }
        });

        document.addEventListener("keydown", (e) => {
            socket.emit("move", (ID, position, [position[0], position[1] + 1]));
        });
</html>